import React, { useState, useMemo, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Search, Wallet, Heart, Info, TrendingUp, Globe, Navigation2, ArrowUpDown, ChevronDown, Filter } from 'lucide-react';

// è´§å¸é…ç½®ä¸è¿‘ä¼¼æ±‡ç‡ (ä»¥ 1 USD ä¸ºåŸºå‡†)
const CURRENCIES = [
  { code: 'USD', symbol: '$', label: 'ç¾å…ƒ', rate: 1 },
  { code: 'EUR', symbol: 'â‚¬', label: 'æ¬§å…ƒ', rate: 0.92 },
  { code: 'GBP', symbol: 'Â£', label: 'è‹±é•‘', rate: 0.79 },
  { code: 'JPY', symbol: 'Â¥', label: 'æ—¥å…ƒ', rate: 150.5 },
  { code: 'CNY', symbol: 'Â¥', label: 'äººæ°‘å¸', rate: 7.2 },
  { code: 'AUD', symbol: 'A$', label: 'æ¾³å¸', rate: 1.53 },
];

/**
 * åŸå¸‚æ•°æ®åº“æ‰©å……è‡³ 100 ä¸ª
 * CLI: ç”Ÿæ´»æˆæœ¬æŒ‡æ•° (100 = çº½çº¦)
 * Health: åŒ»ç–—ä¿å¥æŒ‡æ•° (0-100)
 * Base: åŸºç¡€å®œå±…/ç¯å¢ƒæŒ‡æ•° (0-100)
 */
const INITIAL_CITIES = [
  // --- äºšæ´² (Asia) 30 åŸå¸‚ ---
  { id: 1, name: "æ¸…è¿ˆ", country: "æ³°å›½", cli: 26, health: 70, base: 75, tag: "æ•°å­—æ¸¸æ°‘ æ…¢ç”Ÿæ´» æ€§ä»·æ¯” æš–å†¬", flag: "ğŸ‡¹ğŸ‡­" },
  { id: 2, name: "ä¸œäº¬", country: "æ—¥æœ¬", cli: 68, health: 92, base: 88, tag: "æè‡´ä¾¿åˆ© æ²»å®‰ å¹²å‡€ æ–‡åŒ–", flag: "ğŸ‡¯ğŸ‡µ" },
  { id: 3, name: "æ›¼è°·", country: "æ³°å›½", cli: 38, health: 75, base: 78, tag: "ç¾é£Ÿ è´­ç‰© ç¹å æ´»åŠ›", flag: "ğŸ‡¹ğŸ‡­" },
  { id: 4, name: "å°åŒ—", country: "ä¸­å›½å°æ¹¾", cli: 52, health: 96, base: 84, tag: "é¡¶çº§åŒ»ç–— ç¾é£Ÿ ä¾¿åˆ© æ€§ä»·æ¯”", flag: "ğŸ‡¹ğŸ‡¼" },
  { id: 5, name: "æ–°åŠ å¡", country: "æ–°åŠ å¡", cli: 105, health: 94, base: 85, tag: "æåº¦å®‰å…¨ é‡‘è é¿ç¨ ç²¾è‹±", flag: "ğŸ‡¸ğŸ‡¬" },
  { id: 6, name: "é¦–å°”", country: "éŸ©å›½", cli: 72, health: 94, base: 82, tag: "ç§‘æŠ€ç”Ÿæ´» 24å°æ—¶ æ½®æµ", flag: "ğŸ‡°ğŸ‡·" },
  { id: 7, name: "å·´å˜å²›", country: "å°å°¼", cli: 24, health: 50, base: 72, tag: "å†²æµª çµæ€§ ç‘œä¼½ æ…¢ç”Ÿæ´»", flag: "ğŸ‡®ğŸ‡©" },
  { id: 8, name: "å‰éš†å¡", country: "é©¬æ¥è¥¿äºš", cli: 32, health: 74, base: 74, tag: "è¶…é«˜æ€§ä»·æ¯” ç°ä»£ å¤šå…ƒæ–‡åŒ–", flag: "ğŸ‡²ğŸ‡¾" },
  { id: 9, name: "å²˜æ¸¯", country: "è¶Šå—", cli: 23, health: 50, base: 68, tag: "æµ·æ»¨ æ…¢ç”Ÿæ´» æ€§ä»·æ¯” æ—…æ¸¸", flag: "ğŸ‡»ğŸ‡³" },
  { id: 10, name: "é¦™æ¸¯", country: "ä¸­å›½é¦™æ¸¯", cli: 98, health: 88, base: 80, tag: "é‡‘èä¸­å¿ƒ é«˜æ•ˆç‡ ç¹å ç¾é£Ÿ", flag: "ğŸ‡­ğŸ‡°" },
  { id: 11, name: "ä¸Šæµ·", country: "ä¸­å›½", cli: 55, health: 85, base: 78, tag: "å›½é™…å¤§éƒ½å¸‚ æåº¦ä¾¿åˆ© å•†ä¸š", flag: "ğŸ‡¨ğŸ‡³" },
  { id: 12, name: "èƒ¡å¿—æ˜å¸‚", country: "è¶Šå—", cli: 28, health: 55, base: 65, tag: "æ´»åŠ› åˆ›ä¸š å’–å•¡æ–‡åŒ– è¡—å¤´", flag: "ğŸ‡»ğŸ‡³" },
  { id: 13, name: "æ™®å‰å²›", country: "æ³°å›½", cli: 34, health: 65, base: 76, tag: "æµ·å²›åº¦å‡ é€€ä¼‘é¦–é€‰ é˜³å…‰", flag: "ğŸ‡¹ğŸ‡­" },
  { id: 14, name: "å¤§é˜ª", country: "æ—¥æœ¬", cli: 60, health: 90, base: 86, tag: "ç¾é£Ÿæ–‡åŒ– çƒ­æƒ… å•†ä¸š ä¾¿åˆ©", flag: "ğŸ‡¯ğŸ‡µ" },
  { id: 15, name: "äº¬éƒ½", country: "æ—¥æœ¬", cli: 62, health: 88, base: 92, tag: "ä¼ ç»Ÿæ–‡åŒ– å®é™ è‰ºæœ¯ å®œå±…", flag: "ğŸ‡¯ğŸ‡µ" },
  { id: 16, name: "åŒ—äº¬", country: "ä¸­å›½", cli: 58, health: 86, base: 75, tag: "æ”¿æ²»æ–‡åŒ–ä¸­å¿ƒ å†å² èµ„æº", flag: "ğŸ‡¨ğŸ‡³" },
  { id: 17, name: "æ·±åœ³", country: "ä¸­å›½", cli: 54, health: 82, base: 76, tag: "ç§‘æŠ€ä¹‹éƒ½ ç¡¬ä»¶ åˆ›ä¸š æ´»åŠ›", flag: "ğŸ‡¨ğŸ‡³" },
  { id: 18, name: "æˆéƒ½", country: "ä¸­å›½", cli: 42, health: 80, base: 82, tag: "æ…¢ç”Ÿæ´» ç¾é£Ÿ å¤§ç†ŠçŒ« ä¼‘é—²", flag: "ğŸ‡¨ğŸ‡³" },
  { id: 19, name: "å¹¿å·", country: "ä¸­å›½", cli: 50, health: 84, base: 79, tag: "ç¾é£Ÿä¹‹éƒ½ å•†è´¸ åŒ…å®¹æ€§", flag: "ğŸ‡¨ğŸ‡³" },
  { id: 20, name: "æ­å·", country: "ä¸­å›½", cli: 48, health: 85, base: 88, tag: "äº’è”ç½‘ æ™¯è§‚ å®œå±… é›…è‡´", flag: "ğŸ‡¨ğŸ‡³" },
  { id: 21, name: "ç¦å†ˆ", country: "æ—¥æœ¬", cli: 55, health: 92, base: 89, tag: "å®œå±… åˆ›æ–° ç´§å‡‘åŸå¸‚", flag: "ğŸ‡¯ğŸ‡µ" },
  { id: 22, name: "æ²³å†…", country: "è¶Šå—", cli: 25, health: 48, base: 62, tag: "å†å² æ–‡åŒ– å»‰ä»· ç”Ÿæ´»æ°”", flag: "ğŸ‡»ğŸ‡³" },
  { id: 23, name: "æ§ŸåŸ", country: "é©¬æ¥è¥¿äºš", cli: 30, health: 78, base: 80, tag: "ä¸–ç•Œé—äº§ ç¾é£Ÿ é€€ä¼‘å¤©å ‚", flag: "ğŸ‡²ğŸ‡¾" },
  { id: 24, name: "å®¿åŠ¡", country: "è²å¾‹å®¾", cli: 32, health: 45, base: 66, tag: "æµ·å²› è‹±è¯­ç¯å¢ƒ æ€§ä»·æ¯”", flag: "ğŸ‡µğŸ‡­" },
  { id: 25, name: "é©¬å°¼æ‹‰", country: "è²å¾‹å®¾", cli: 40, health: 58, base: 60, tag: "å•†ä¸š æ´»åŠ› ç¤¾äº¤", flag: "ğŸ‡µğŸ‡­" },
  { id: 26, name: "å­Ÿä¹°", country: "å°åº¦", cli: 25, health: 42, base: 55, tag: "ç”µå½±ä¸­å¿ƒ æ´»åŠ› å•†ä¸š", flag: "ğŸ‡®ğŸ‡³" },
  { id: 27, name: "å¾·é‡Œ", country: "å°åº¦", cli: 22, health: 45, base: 52, tag: "å†å² æ”¿æ²» è‰²å½©", flag: "ğŸ‡®ğŸ‡³" },
  { id: 28, name: "æ¸…è±", country: "æ³°å›½", cli: 22, health: 62, base: 74, tag: "æåº¦æ€§ä»·æ¯” å®é™ è‰ºæœ¯", flag: "ğŸ‡¹ğŸ‡­" },
  { id: 29, name: "ä¹Œå¸ƒ", country: "å°å°¼", cli: 23, health: 48, base: 78, tag: "è‰ºæœ¯ ç‘œä¼½ æ¢¯ç”° çµæ€§", flag: "ğŸ‡®ğŸ‡©" },
  { id: 30, name: "æš¹ç²’", country: "æŸ¬åŸ”å¯¨", cli: 28, health: 35, base: 65, tag: "å¤è¿¹ æ—…æ¸¸ å»‰ä»·", flag: "ğŸ‡°ğŸ‡­" },

  // --- æ¬§æ´² (Europe) 35 åŸå¸‚ ---
  { id: 31, name: "è‹é»ä¸–", country: "ç‘å£«", cli: 122, health: 95, base: 92, tag: "æè‡´å®‰å…¨ é‡‘è é«˜ç«¯ ç§©åº", flag: "ğŸ‡¨ğŸ‡­" },
  { id: 32, name: "é‡Œæ–¯æœ¬", country: "è‘¡è„ç‰™", cli: 49, health: 80, base: 85, tag: "ä½ç¨å¤©å ‚ æ•°å­—æ¸¸æ°‘ æš–å†¬ å†²æµª", flag: "ğŸ‡µğŸ‡¹" },
  { id: 33, name: "æŸæ—", country: "å¾·å›½", cli: 65, health: 90, base: 82, tag: "è‰ºæœ¯æ°›å›´ è‡ªç”± å†å² äºšæ–‡åŒ–", flag: "ğŸ‡©ğŸ‡ª" },
  { id: 34, name: "é˜¿å§†æ–¯ç‰¹ä¸¹", country: "è·å…°", cli: 88, health: 88, base: 89, tag: "è‡ªè¡Œè½¦å‹å¥½ è¿æ²³ è‰ºæœ¯ è‡ªç”±", flag: "ğŸ‡³ğŸ‡±" },
  { id: 35, name: "å¸ƒæ‹‰æ ¼", country: "æ·å…‹", cli: 45, health: 84, base: 83, tag: "ä¸­æ¬§æ˜ç  ç«¥è¯ å•¤é…’ å†å²", flag: "ğŸ‡¨ğŸ‡¿" },
  { id: 36, name: "é©¬å¾·é‡Œ", country: "è¥¿ç­ç‰™", cli: 55, health: 93, base: 86, tag: "çƒ­æƒ… é˜³å…‰ åŒ»ç–— å¤œç”Ÿæ´»", flag: "ğŸ‡ªğŸ‡¸" },
  { id: 37, name: "å“¥æœ¬å“ˆæ ¹", country: "ä¸¹éº¦", cli: 98, health: 90, base: 94, tag: "é«˜ç¦åˆ© æè‡´è®¾è®¡ å¹¸ç¦æ„Ÿ è®¾è®¡", flag: "ğŸ‡©ğŸ‡°" },
  { id: 38, name: "ç»´ä¹Ÿçº³", country: "å¥¥åœ°åˆ©", cli: 68, health: 93, base: 95, tag: "è‰ºæœ¯ä¹‹éƒ½ æœ€å®œå±… å¤å…¸ éŸ³ä¹", flag: "ğŸ‡¦ğŸ‡¹" },
  { id: 39, name: "ä¼¦æ•¦", country: "è‹±å›½", cli: 95, health: 82, base: 80, tag: "å…¨çƒæ¢çº½ æ–‡åŒ– å†å² é‡‘è", flag: "ğŸ‡¬ğŸ‡§" },
  { id: 40, name: "å·´é»", country: "æ³•å›½", cli: 92, health: 88, base: 81, tag: "æµªæ¼« è‰ºæœ¯ æ—¶å°š å¥¢ä¾ˆå“", flag: "ğŸ‡«ğŸ‡·" },
  { id: 41, name: "é›…å…¸", country: "å¸Œè…Š", cli: 48, health: 70, base: 74, tag: "å†å²åº•è•´ é˜³å…‰ æ€§ä»·æ¯” å¤è¿¹", flag: "ğŸ‡¬ğŸ‡·" },
  { id: 42, name: "å·´å¡ç½—é‚£", country: "è¥¿ç­ç‰™", cli: 58, health: 91, base: 88, tag: "æµ·æ»© é«˜è¿ª é˜³å…‰ è¶³çƒ", flag: "ğŸ‡ªğŸ‡¸" },
  { id: 43, name: "é›·å…‹é›…æœªå…‹", country: "å†°å²›", cli: 105, health: 89, base: 90, tag: "è‡ªç„¶å¥‡è§‚ çº¯å‡€ å®‰å…¨ æå…‰", flag: "ğŸ‡®ğŸ‡¸" },
  { id: 44, name: "æ³¢å°”å›¾", country: "è‘¡è„ç‰™", cli: 44, health: 78, base: 83, tag: "è‘¡è„é…’ ç¾æ™¯ ä½ç”Ÿæ´»æˆæœ¬", flag: "ğŸ‡µğŸ‡¹" },
  { id: 45, name: "æ…•å°¼é»‘", country: "å¾·å›½", cli: 82, health: 94, base: 90, tag: "å·¥ä¸š æ²»å®‰ å•¤é…’èŠ‚ ç¨³å®š", flag: "ğŸ‡©ğŸ‡ª" },
  { id: 46, name: "æ–¯å¾·å“¥å°”æ‘©", country: "ç‘å…¸", cli: 78, health: 91, base: 90, tag: "æç®€ç”Ÿæ´» å²›å±¿ è®¾è®¡ ç¨³å®š", flag: "ğŸ‡¸ğŸ‡ª" },
  { id: 47, name: "èµ«å°”è¾›åŸº", country: "èŠ¬å…°", cli: 75, health: 92, base: 91, tag: "æœ€å¹¸ç¦ æç®€ è‡ªç„¶ æ•™è‚²", flag: "ğŸ‡«ğŸ‡®" },
  { id: 48, name: "éƒ½æŸæ—", country: "çˆ±å°”å…°", cli: 90, health: 80, base: 82, tag: "ç§‘æŠ€å…¬å¸ è‹±è¯­ é…’å§æ–‡åŒ–", flag: "ğŸ‡®ğŸ‡ª" },
  { id: 49, name: "åæ²™", country: "æ³¢å…°", cli: 40, health: 72, base: 78, tag: "ç»æµå¢é•¿ æ€§ä»·æ¯” å†å²", flag: "ğŸ‡µğŸ‡±" },
  { id: 50, name: "å¸ƒè¾¾ä½©æ–¯", country: "åŒˆç‰™åˆ©", cli: 38, health: 65, base: 80, tag: "æ¸©æ³‰ å»ºç­‘ å¤œç”Ÿæ´» æ™¯è§‚", flag: "ğŸ‡­ğŸ‡º" },
  { id: 51, name: "å¡”æ—", country: "çˆ±æ²™å°¼äºš", cli: 52, health: 82, base: 84, tag: "æ•°å­—æ¸¸æ°‘ ç§‘æŠ€ å¤åŸ ç”µå­å…¬æ°‘", flag: "ğŸ‡ªğŸ‡ª" },
  { id: 52, name: "ç“¦ä¼¦è¥¿äºš", country: "è¥¿ç­ç‰™", cli: 50, health: 90, base: 89, tag: "æ€§ä»·æ¯” é€€ä¼‘ é˜³å…‰ å®œå±…", flag: "ğŸ‡ªğŸ‡¸" },
  { id: 53, name: "æ³¢å°”å¤š", country: "æ³•å›½", cli: 65, health: 88, base: 87, tag: "çº¢é…’ ä¼˜é›… ç”Ÿæ´»å“è´¨", flag: "ğŸ‡«ğŸ‡·" },
  { id: 54, name: "ç½—é©¬", country: "æ„å¤§åˆ©", cli: 70, health: 80, base: 78, tag: "å†å² è‰ºæœ¯ ç¾é£Ÿ æ°¸æ’", flag: "ğŸ‡®ğŸ‡¹" },
  { id: 55, name: "ä½›ç½—ä¼¦è¨", country: "æ„å¤§åˆ©", cli: 68, health: 82, base: 85, tag: "æ–‡è‰ºå¤å…´ è‰ºæœ¯ ç´§å‡‘", flag: "ğŸ‡®ğŸ‡¹" },
  { id: 56, name: "æ—¥å†…ç“¦", country: "ç‘å£«", cli: 115, health: 95, base: 89, tag: "å›½é™…ç»„ç»‡ æ²»å®‰ ç¯å¢ƒ", flag: "ğŸ‡¨ğŸ‡­" },
  { id: 57, name: "ç±³å…°", country: "æ„å¤§åˆ©", cli: 78, health: 88, base: 79, tag: "æ—¶å°š å•†ä¸š è®¾è®¡", flag: "ğŸ‡®ğŸ‡¹" },
  { id: 58, name: "å¥¥æ–¯é™†", country: "æŒªå¨", cli: 102, health: 92, base: 93, tag: "é«˜ç¦åˆ© å³¡æ¹¾ æè‡´ç¯ä¿", flag: "ğŸ‡³ğŸ‡´" },
  { id: 59, name: "ç½—å¸Œå§†è¯º", country: "å¸Œè…Š", cli: 42, health: 68, base: 75, tag: "åœ°ä¸­æµ· æµ·æ»¨ é€€ä¼‘ æ…¢èŠ‚å¥", flag: "ğŸ‡¬ğŸ‡·" },
  { id: 60, name: "å¢æ£®å ¡å¸‚", country: "å¢æ£®å ¡", cli: 95, health: 94, base: 88, tag: "å¯Œè£• å®‰å…¨ é‡‘è", flag: "ğŸ‡±ğŸ‡º" },
  { id: 61, name: "å…‹æ‹‰ç§‘å¤«", country: "æ³¢å…°", cli: 36, health: 70, base: 82, tag: "å¤åŸ æ–‡åŒ– å­¦ç”Ÿ å»‰ä»·", flag: "ğŸ‡µğŸ‡±" },
  { id: 62, name: "å¸ƒåŠ å‹’æ–¯ç‰¹", country: "ç½—é©¬å°¼äºš", cli: 35, health: 62, base: 70, tag: "ä½æˆæœ¬ ä¸œæ¬§é£æƒ… å‘å±•", flag: "ğŸ‡·ğŸ‡´" },
  { id: 63, name: "å°¼ç§‘è¥¿äºš", country: "å¡æµ¦è·¯æ–¯", cli: 45, health: 75, base: 78, tag: "ä½ç¨ é˜³å…‰ é¿ç¨å¤©å ‚", flag: "ğŸ‡¨ğŸ‡¾" },
  { id: 64, name: "ç“¦è±å¡”", country: "é©¬è€³ä»–", cli: 55, health: 88, base: 82, tag: "æš–å†¬ æµ·æ»¨ è‹±è¯­ åŒ»ç–—", flag: "ğŸ‡²ğŸ‡¹" },
  { id: 65, name: "é‡ŒåŠ ", country: "æ‹‰è„±ç»´äºš", cli: 45, health: 70, base: 75, tag: "æ³¢ç½—çš„æµ· æ–‡åŒ– å®é™", flag: "ğŸ‡±ğŸ‡»" },

  // --- ç¾æ´² (Americas) 20 åŸå¸‚ ---
  { id: 66, name: "æ¸©å“¥å", country: "åŠ æ‹¿å¤§", cli: 82, health: 85, base: 87, tag: "è‡ªç„¶ ç§»æ°‘é¦–é€‰ å®œå±… ç¯å¢ƒ", flag: "ğŸ‡¨ğŸ‡¦" },
  { id: 67, name: "çº½çº¦", country: "ç¾å›½", cli: 100, health: 84, base: 75, tag: "ä¸–ç•Œä¸­å¿ƒ ç¹å æœºé‡ å•†ä¸š", flag: "ğŸ‡ºğŸ‡¸" },
  { id: 68, name: "éº¦å¾·æ—", country: "å“¥ä¼¦æ¯”äºš", cli: 22, health: 65, base: 68, tag: "æ°¸æ’ä¹‹æ˜¥ æ•°å­—æ¸¸æ°‘ æ€§ä»·æ¯”", flag: "ğŸ‡¨ğŸ‡´" },
  { id: 69, name: "å¸ƒå®œè¯ºæ–¯è‰¾åˆ©æ–¯", country: "é˜¿æ ¹å»·", cli: 30, health: 72, base: 70, tag: "å—ç¾å·´é» æ–‡åŒ– è¶³çƒ æ€§ä»·æ¯”", flag: "ğŸ‡¦ğŸ‡·" },
  { id: 70, name: "å¢¨è¥¿å“¥åŸ", country: "å¢¨è¥¿å“¥", cli: 32, health: 60, base: 74, tag: "ç¾é£Ÿ è‰ºæœ¯ æ€§ä»·æ¯” å†å²", flag: "ğŸ‡²ğŸ‡½" },
  { id: 71, name: "å¤šä¼¦å¤š", country: "åŠ æ‹¿å¤§", cli: 80, health: 83, base: 85, tag: "å¤šå…ƒæ–‡åŒ– ç°ä»£ ç¨³å®š ç§»æ°‘", flag: "ğŸ‡¨ğŸ‡¦" },
  { id: 72, name: "å¥¥æ–¯æ±€", country: "ç¾å›½", cli: 75, health: 78, base: 80, tag: "ç§‘æŠ€æ–°è´µ éŸ³ä¹ æ´»åŠ› å¾·å·", flag: "ğŸ‡ºğŸ‡¸" },
  { id: 73, name: "åœ£ä½•å¡", country: "å“¥æ–¯è¾¾é»åŠ ", cli: 40, health: 75, base: 78, tag: "é›¨æ— ç¯ä¿ æ…¢ç”Ÿæ´» é€€ä¼‘", flag: "ğŸ‡¨ğŸ‡·" },
  { id: 74, name: "åˆ©é©¬", country: "ç§˜é²", cli: 30, health: 55, base: 68, tag: "é¡¶çº§ç¾é£Ÿ æµ·æ»¨ æ€§ä»·æ¯”", flag: "ğŸ‡µğŸ‡ª" },
  { id: 75, name: "åœ£åœ°äºšå“¥", country: "æ™ºåˆ©", cli: 45, health: 72, base: 76, tag: "å—ç¾æœ€ç¨³ ç°ä»£ æ»‘é›ª", flag: "ğŸ‡¨ğŸ‡±" },
  { id: 76, name: "é‡Œçº¦çƒ­å†…å¢", country: "å·´è¥¿", cli: 38, health: 58, base: 70, tag: "å˜‰å¹´å æµ·æ»© æ¿€æƒ…", flag: "ğŸ‡§ğŸ‡·" },
  { id: 77, name: "åœ£ä¿ç½—", country: "å·´è¥¿", cli: 42, health: 65, base: 65, tag: "å•†ä¸šä¸­å¿ƒ é¤é¥® æ´»åŠ›", flag: "ğŸ‡§ğŸ‡·" },
  { id: 78, name: "è¿ˆé˜¿å¯†", country: "ç¾å›½", cli: 88, health: 80, base: 78, tag: "é˜³å…‰ æ´¾å¯¹ æµ·æ»© åŠ å‹’æ¯”", flag: "ğŸ‡ºğŸ‡¸" },
  { id: 79, name: "æ—§é‡‘å±±", country: "ç¾å›½", cli: 102, health: 85, base: 80, tag: "ç§‘æŠ€ ç¡…è°· æ™¯è§‚ æ˜‚è´µ", flag: "ğŸ‡ºğŸ‡¸" },
  { id: 80, name: "æ´›æ‰çŸ¶", country: "ç¾å›½", cli: 92, health: 82, base: 78, tag: "å¨±ä¹ å¥½è±å é˜³å…‰ æµ·æ»¨", flag: "ğŸ‡ºğŸ‡¸" },
  { id: 81, name: "è¥¿é›…å›¾", country: "ç¾å›½", cli: 88, health: 84, base: 82, tag: "å’–å•¡ ç§‘æŠ€ é›¨åŸ æˆ·å¤–", flag: "ğŸ‡ºğŸ‡¸" },
  { id: 82, name: "è’™ç‰¹åˆ©å°”", country: "åŠ æ‹¿å¤§", cli: 68, health: 82, base: 88, tag: "åŒè¯­ æ¬§æ´²æ„Ÿ æ–‡åŒ– èŠ‚åº†", flag: "ğŸ‡¨ğŸ‡¦" },
  { id: 83, name: "åæ˜†", country: "å¢¨è¥¿å“¥", cli: 35, health: 55, base: 72, tag: "åº¦å‡ é˜³å…‰ åŠ å‹’æ¯”æµ·", flag: "ğŸ‡²ğŸ‡½" },
  { id: 84, name: "åº“æ–¯ç§‘", country: "ç§˜é²", cli: 25, health: 45, base: 65, tag: "å°åŠ æ–‡åŒ– å†å² å¾’æ­¥ å¤é•‡", flag: "ğŸ‡µğŸ‡ª" },
  { id: 85, name: "è’™ç‰¹ç»´å¤š", country: "ä¹Œæ‹‰åœ­", cli: 55, health: 78, base: 82, tag: "å—ç¾æœ€å®‰å…¨ ç¨³å®š æµ·æ»¨", flag: "ğŸ‡ºğŸ‡¾" },

  // --- å¤§æ´‹æ´² (Oceania) 10 åŸå¸‚ ---
  { id: 86, name: "æ‚‰å°¼", country: "æ¾³å¤§åˆ©äºš", cli: 85, health: 88, base: 90, tag: "é˜³å…‰ æµ·æ»© å®œå±… ç¹å", flag: "ğŸ‡¦ğŸ‡º" },
  { id: 87, name: "å¢¨å°”æœ¬", country: "æ¾³å¤§åˆ©äºš", cli: 82, health: 89, base: 91, tag: "å’–å•¡æ–‡åŒ– è‰ºæœ¯ ä½“è‚² å®œå±…", flag: "ğŸ‡¦ğŸ‡º" },
  { id: 88, name: "å¥¥å…‹å…°", country: "æ–°è¥¿å…°", cli: 80, health: 86, base: 88, tag: "çº¯å‡€ è‡ªç„¶ æˆ·å¤– ç¨³å®š", flag: "ğŸ‡³ğŸ‡¿" },
  { id: 89, name: "å¸ƒé‡Œæ–¯ç­", country: "æ¾³å¤§åˆ©äºš", cli: 75, health: 85, base: 86, tag: "æ‚ é—² é˜³å…‰ æ˜†å£«å…° æ€§ä»·æ¯”", flag: "ğŸ‡¦ğŸ‡º" },
  { id: 90, name: "ç€æ–¯", country: "æ¾³å¤§åˆ©äºš", cli: 70, health: 86, base: 87, tag: "è¥¿æ¾³ ç»ç¾æµ·æ»© çŸ¿ä¸š å®œå±…", flag: "ğŸ‡¦ğŸ‡º" },
  { id: 91, name: "é˜¿å¾·è±å¾·", country: "æ¾³å¤§åˆ©äºš", cli: 68, health: 88, base: 88, tag: "èŠ‚åº† è‘¡è„é…’ æ…¢èŠ‚å¥", flag: "ğŸ‡¦ğŸ‡º" },
  { id: 92, name: "é»„é‡‘æµ·å²¸", country: "æ¾³å¤§åˆ©äºš", cli: 72, health: 84, base: 85, tag: "æ—…æ¸¸ å†²æµª é˜³å…‰ ä¹å›­", flag: "ğŸ‡¦ğŸ‡º" },
  { id: 93, name: "æƒ çµé¡¿", country: "æ–°è¥¿å…°", cli: 78, health: 88, base: 89, tag: "é£åŸ æ–‡åŒ– çº¯å‡€ ç´§å‡‘", flag: "ğŸ‡³ğŸ‡¿" },
  { id: 94, name: "åŸºç£åŸ", country: "æ–°è¥¿å…°", cli: 70, health: 85, base: 84, tag: "èŠ±å›­ä¹‹åŸ å¤å…´ å®é™", flag: "ğŸ‡³ğŸ‡¿" },
  { id: 95, name: "å ªåŸ¹æ‹‰", country: "æ¾³å¤§åˆ©äºš", cli: 80, health: 92, base: 88, tag: "æ”¿æ²»ä¸­å¿ƒ è§„åˆ’ æ£®æ— æ²»å®‰", flag: "ğŸ‡¦ğŸ‡º" },

  // --- éæ´²ä¸ä¸­ä¸œ (Africa & ME) 5 åŸå¸‚ ---
  { id: 96, name: "å¼€æ™®æ•¦", country: "å—é", cli: 35, health: 68, base: 72, tag: "å±±æµ·ä¹‹é—´ ç¾æ™¯ å†’é™© è‘¡è„é…’", flag: "ğŸ‡¿ğŸ‡¦" },
  { id: 97, name: "è¿ªæ‹œ", country: "é˜¿è”é…‹", cli: 75, health: 80, base: 78, tag: "æœªæ¥æ„Ÿ å¥¢å å…ç¨ é«˜ç«¯", flag: "ğŸ‡¦ğŸ‡ª" },
  { id: 98, name: "é©¬æ‹‰å–€ä»€", country: "æ‘©æ´›å“¥", cli: 28, health: 50, base: 65, tag: "å¼‚åŸŸé£æƒ… å¤šå½© å†å² æ‘©å°”", flag: "ğŸ‡²ğŸ‡¦" },
  { id: 99, name: "é˜¿å¸ƒæ‰æ¯”", country: "é˜¿è”é…‹", cli: 72, health: 85, base: 80, tag: "é«˜ç«¯ å®‰å…¨ è‰ºæœ¯ ç¨³å®š", flag: "ğŸ‡¦ğŸ‡ª" },
  { id: 100, name: "ç‰¹æ‹‰ç»´å¤«", country: "ä»¥è‰²åˆ—", cli: 92, health: 88, base: 82, tag: "ç§‘æŠ€ åˆ›ä¸š æµ·æ»© ä¸å¤œåŸ", flag: "ğŸ‡®ğŸ‡±" },
];

const App = () => {
  const [income, setIncome] = useState(0);
  const [currency, setCurrency] = useState(CURRENCIES[0]);
  const [searchTerm, setSearchTerm] = useState("");
  const [isDarkMode, setIsDarkMode] = useState(true);
  const [sortBy, setSortBy] = useState("hpScore");

  // ç»¼åˆè®¡ç®—ä¸å¤šç»´æœç´¢è¿‡æ»¤
  const processedData = useMemo(() => {
    const usdEquivalent = income / currency.rate;

    return INITIAL_CITIES.map(city => {
      // PP Score: åŸºäº 100k ç¾å…ƒåŸºå‡†çš„è´­ä¹°åŠ›å€ç‡
      const ppScore = income === 0 ? 0 : Math.round(100 * (100 / city.cli) * (usdEquivalent / 100000));
      // Happiness Score: æƒé‡åˆ†é… 60/20/20
      const hpScore = Math.round((city.base * 0.6) + (Math.min(100, ppScore * 0.5) * 0.2) + (city.health * 0.2));
      return { ...city, ppScore, hpScore };
    })
    .filter(city => {
      const search = searchTerm.toLowerCase();
      // æ·±åº¦æœç´¢ï¼šåŸå¸‚åã€å›½å®¶åã€æ ‡ç­¾
      return city.name.toLowerCase().includes(search) || 
             city.country.toLowerCase().includes(search) || 
             city.tag.toLowerCase().includes(search);
    })
    .sort((a, b) => b[sortBy] - a[sortBy]);
  }, [income, currency, searchTerm, sortBy]);

  return (
    <div className={`min-h-screen transition-colors duration-500 ${isDarkMode ? 'bg-[#050505] text-white' : 'bg-slate-50 text-slate-900'} font-sans p-4 md:p-12`}>
      {/* Background Decor */}
      <div className="fixed inset-0 overflow-hidden pointer-events-none">
        <div className="absolute -top-[10%] -left-[10%] w-[50%] h-[50%] rounded-full blur-[140px] opacity-20 bg-indigo-600 animate-pulse"></div>
        <div className="absolute top-[50%] -right-[10%] w-[40%] h-[60%] rounded-full blur-[140px] opacity-10 bg-emerald-500"></div>
      </div>

      <div className="max-w-7xl mx-auto relative z-10">
        {/* Navigation & Controls */}
        <header className="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-10 mb-16">
          <div className="space-y-2">
            <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className="flex items-center gap-2 text-indigo-500 font-bold">
              <Globe size={18} />
              <span className="uppercase text-[10px] tracking-[0.4em]">Global Intelligence Platform</span>
            </motion.div>
            <h1 className="text-5xl md:text-7xl font-black tracking-tighter">
              World <span className="text-indigo-500">Scale</span>
            </h1>
            <p className="opacity-40 text-sm font-medium">å·²é›†æˆ 100 ä¸ªå…¨çƒç›®çš„åœ°å®æ—¶æ•°æ®æ¨¡å‹</p>
          </div>

          <motion.div 
            initial={{ scale: 0.95, opacity: 0 }} 
            animate={{ scale: 1, opacity: 1 }}
            className={`w-full lg:w-auto p-6 rounded-[35px] border ${isDarkMode ? 'bg-white/5 border-white/10' : 'bg-white border-slate-200 shadow-2xl shadow-indigo-500/10'}`}
          >
            <div className="flex flex-col md:flex-row items-center gap-6">
              <div className="flex flex-col">
                <span className="text-[10px] font-black uppercase text-gray-500 mb-2 tracking-widest">é¢„ç®—é…ç½® / Budget</span>
                <div className="flex items-center gap-4">
                  <div className="relative">
                    <select 
                      value={currency.code}
                      onChange={(e) => setCurrency(CURRENCIES.find(c => c.code === e.target.value))}
                      className={`appearance-none bg-transparent pl-2 pr-8 py-1 text-xl font-bold border-b-2 border-indigo-500/40 outline-none cursor-pointer ${isDarkMode ? '[&_option]:bg-zinc-900' : '[&_option]:bg-white'}`}
                    >
                      {CURRENCIES.map(c => <option key={c.code} value={c.code}>{c.code}</option>)}
                    </select>
                    <ChevronDown size={14} className="absolute right-2 top-1/2 -translate-y-1/2 opacity-30 pointer-events-none" />
                  </div>
                  <div className="flex items-center gap-2">
                    <span className="text-3xl font-light opacity-20">{currency.symbol}</span>
                    <input 
                      type="number" 
                      placeholder="0"
                      value={income === 0 ? "" : income}
                      onChange={(e) => setIncome(Number(e.target.value))}
                      className="bg-transparent text-4xl font-bold outline-none w-48 border-b-2 border-white/5 focus:border-indigo-500/50 transition-all"
                    />
                  </div>
                </div>
              </div>
              <button 
                onClick={() => setIsDarkMode(!isDarkMode)}
                className={`w-14 h-14 rounded-full flex items-center justify-center ${isDarkMode ? 'bg-white/10 hover:bg-white/20' : 'bg-slate-100 hover:bg-slate-200'} transition-all text-2xl`}
              >
                {isDarkMode ? "ğŸŒ™" : "â˜€ï¸"}
              </button>
            </div>
          </motion.div>
        </header>

        {/* Dynamic Search & Filter Bar */}
        <div className="flex flex-col md:flex-row gap-4 mb-12">
          <div className={`flex-1 group flex items-center gap-4 px-8 py-5 rounded-[25px] border transition-all ${isDarkMode ? 'bg-white/5 border-white/10 focus-within:border-indigo-500/50' : 'bg-white border-slate-200 shadow-sm shadow-slate-200/50'}`}>
            <Search className="text-gray-500 group-focus-within:text-indigo-500 transition-colors" size={22} />
            <input 
              placeholder="æœç´¢åŸå¸‚ã€å›½å®¶ã€æ ‡ç­¾ (å¦‚: 'æ•°å­—æ¸¸æ°‘', 'ä½ç¨', 'åŒ»ç–—')..."
              className="bg-transparent outline-none w-full text-lg font-medium placeholder:opacity-20"
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
            />
          </div>

          <div className={`p-1.5 flex gap-1 rounded-[25px] border ${isDarkMode ? 'bg-white/5 border-white/10' : 'bg-white border-slate-200'}`}>
            <button 
              onClick={() => setSortBy('hpScore')}
              className={`px-8 py-3 rounded-[18px] text-xs font-black uppercase tracking-widest relative transition-all ${sortBy === 'hpScore' ? 'text-white' : 'text-gray-500 hover:text-gray-400'}`}
            >
              {sortBy === 'hpScore' && <motion.div layoutId="activeNav" className="absolute inset-0 bg-indigo-600 rounded-[18px] -z-10" />}
              <div className="flex items-center gap-2"><Heart size={14}/> å¹¸ç¦æŒ‡æ•°</div>
            </button>
            <button 
              onClick={() => setSortBy('ppScore')}
              className={`px-8 py-3 rounded-[18px] text-xs font-black uppercase tracking-widest relative transition-all ${sortBy === 'ppScore' ? 'text-white' : 'text-gray-500 hover:text-gray-400'}`}
            >
              {sortBy === 'ppScore' && <motion.div layoutId="activeNav" className="absolute inset-0 bg-indigo-600 rounded-[18px] -z-10" />}
              <div className="flex items-center gap-2"><Wallet size={14}/> æ¶ˆè´¹èƒ½åŠ›</div>
            </button>
          </div>
        </div>

        {/* Huge Result Grid */}
        <motion.div layout className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
          <AnimatePresence mode="popLayout">
            {processedData.map((city, index) => (
              <motion.div
                key={city.id}
                layout
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                exit={{ opacity: 0, scale: 0.9 }}
                transition={{ 
                  delay: (index % 12) * 0.03,
                  layout: { duration: 0.4, type: "spring", stiffness: 200, damping: 30 }
                }}
                className={`group relative p-8 rounded-[45px] border transition-all duration-500 ${isDarkMode ? 'bg-white/[0.03] border-white/10 hover:bg-white/[0.08] hover:border-white/30' : 'bg-white border-slate-200 hover:shadow-2xl hover:shadow-slate-200 shadow-sm shadow-slate-100'}`}
              >
                {/* Visual Accent */}
                <div className="absolute top-8 right-8 text-7xl opacity-5 group-hover:opacity-10 group-hover:-rotate-12 transition-all pointer-events-none select-none">
                  {city.flag}
                </div>

                <div className="relative">
                  <div className="flex flex-wrap gap-2 mb-6">
                    {city.tag.split(" ").slice(0, 2).map(t => (
                      <span key={t} className={`px-2.5 py-1 rounded-full text-[9px] font-black uppercase tracking-tighter ${isDarkMode ? 'bg-white/10 text-gray-400' : 'bg-slate-100 text-slate-500'}`}>
                        #{t}
                      </span>
                    ))}
                  </div>

                  <h3 className="text-2xl font-black mb-1 leading-tight">{city.name}</h3>
                  <p className="text-indigo-500 text-xs font-bold uppercase tracking-[0.2em] mb-8">{city.country}</p>

                  <div className="space-y-6">
                    <div>
                      <div className="flex justify-between text-[10px] font-black uppercase opacity-40 mb-2 tracking-widest">
                        <span>Purchasing Power</span>
                        <span className={city.ppScore > 100 ? "text-emerald-500" : ""}>{city.ppScore}%</span>
                      </div>
                      <div className={`h-1 w-full rounded-full ${isDarkMode ? 'bg-white/5' : 'bg-slate-100'}`}>
                        <motion.div 
                          animate={{ width: `${Math.min(100, city.ppScore)}%` }}
                          className={`h-full rounded-full bg-gradient-to-r ${city.ppScore > 100 ? 'from-emerald-500 to-teal-400' : 'from-indigo-600 to-indigo-400'}`}
                        />
                      </div>
                    </div>

                    <div>
                      <div className="flex justify-between text-[10px] font-black uppercase opacity-40 mb-2 tracking-widest">
                        <span>Happiness Index</span>
                        <span className="text-emerald-500">{city.hpScore}/100</span>
                      </div>
                      <div className={`h-1 w-full rounded-full ${isDarkMode ? 'bg-white/5' : 'bg-slate-100'}`}>
                        <motion.div 
                          animate={{ width: `${city.hpScore}%` }}
                          className="h-full rounded-full bg-gradient-to-r from-emerald-500 to-teal-300"
                        />
                      </div>
                    </div>
                  </div>

                  <div className={`mt-8 pt-6 border-t ${isDarkMode ? 'border-white/5' : 'border-slate-100'} flex items-center justify-between`}>
                    <div className="flex gap-4">
                      <div className="text-center">
                        <p className="text-[8px] font-black opacity-30 uppercase">Health</p>
                        <p className="text-xs font-bold">{city.health}</p>
                      </div>
                      <div className="text-center">
                        <p className="text-[8px] font-black opacity-30 uppercase">CLI Index</p>
                        <p className="text-xs font-bold">{city.cli}</p>
                      </div>
                    </div>
                    <motion.button whileTap={{ scale: 0.9 }} className={`p-2 rounded-2xl ${isDarkMode ? 'bg-white/5 hover:bg-white/10' : 'bg-slate-100 hover:bg-slate-200 shadow-sm'} transition-colors`}>
                      <Navigation2 size={16} className="text-indigo-500" />
                    </motion.button>
                  </div>
                </div>
              </motion.div>
            ))}
          </AnimatePresence>
        </motion.div>

        {processedData.length === 0 && (
          <div className="text-center py-40 opacity-20 italic text-xl font-light">
            æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„åŸå¸‚ï¼Œæ¢ä¸ªå…³é”®è¯è¯•è¯•ï¼Ÿ (ä¾‹å¦‚: "æš–å†¬", "å†²æµª", "ç§‘æŠ€")
          </div>
        )}

        <footer className="mt-32 pb-12 border-t border-white/5 pt-12 flex flex-col md:flex-row justify-between items-center gap-6 opacity-30 text-[10px] font-bold uppercase tracking-[0.3em]">
          <p>Â© 2024 Global Scale Index v2.5</p>
          <div className="flex gap-8">
            <span>æ•°æ®æº: Numbeo Global Database</span>
            <span>è¦†ç›–åŸå¸‚: 100 å…¨çƒèŠ‚ç‚¹</span>
          </div>
        </footer>
      </div>
    </div>
  );
};

export default App;
